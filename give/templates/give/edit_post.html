
{% load static %}

{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Post - Give&Share</title>
    <link rel="shortcut icon" href="{% static 'image/logo.png' %}">
    <link rel="stylesheet" href="{% static 'css/editpost.css' %}">
    <script defer src="{% static 'js/editpost.js' %}"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VBV26B24W3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-VBV26B24W3');
</script>
    <meta name="description" content="{% block description %}Edit your existing posts on Give&Share. Update titles, descriptions, categories, and images to keep your shared resources relevant and accessible to the community.{% endblock %}">
    <meta name="keywords" content="{% block keywords %}Give&Share, edit post, update resources, post management, edit title, update description, change category, upload images, community sharing, resource accessibility{% endblock %}">
    <style>
	.edit-post-form .form-control {
    width:100%;
    max-width:600px;
    margin-bottom:20px;
}
</style>
</head>
<body>
    <nav class="sidebar" id="menu" aria-hidden="true">
        <button class="close-btn" aria-label="Close menu">×</button>
        <img src="{% static 'image\icone.png' %}" alt="Give&Share logo" class="logo">
        <ul>
            <li><img src="{% static 'image\home.svg' %}" style="width:30px;height:30px"><a href="{% url 'dashboard' %}">Dashboard</a></li>
            <li><img src="{% static 'image\person-male.svg' %}" style="width:30px;height:30px"><a href="{% url 'portfolio' %}">My Portfolio</a></li>
            <li><img src="{% static 'image\search.svg' %}" style="width:30px;height:30px"><a href="{% url 'search' %}">Search</a></li>
            <li><img src="{% static 'image\edit-file.svg' %}" style="width:30px;height:30px"><a href="{% url 'create_post' %}">Make Post</a></li>
            <li><img src="{% static 'image\chat-bubble.svg' %}" style="width:30px;height:30px"><a href="{% url 'chat_page' %}">Chat</a></li>
        </ul>
        <div class="bottom-images">
            <img src="{% static 'image\box1.png' %}" alt="Additional Image 1" style="left:-90px;bottom:0;width:250px;height:250px">
            <img src="{% static 'image\box2.png' %}" alt="Additional Image 2" style="left:-80px;width:250px;height:250px;bottom:-100px">
            <img src="{% static 'image\box3.png' %}" alt="Additional Image 3" style="left:50px;bottom:-60px">
        </div>
    </nav>
    <div class="main-container">
        <div class="navbar">
            <button class="hamburger" aria-label="Open menu" aria-expanded="false" aria-controls="menu">
                ☰
            </button>
        </div>
        <div class="content">
            <h1>Edit Post</h1>
            <form class="edit-post-form" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                {{ form.non_field_errors }}
                
                <label for="title">Title:</label>
                {{ form.title }}

                <label for="description">Description:</label>
                {{ form.description }}

                <label for="category">Category:</label>
                {{ form.category }}

                <label for="current-images">Current Images:</label>
                <div class="current-images" id="current-images">
                    <ul>
                        {% for photo in post.photos.all %}
                        <li>
                            <div class="image-preview">
                                <img src="{{ photo.image.url }}" alt="{{ photo.description }}" style="max-width: 100px; max-height: 100px;">
                                <input type="checkbox" name="delete_images" value="{{ photo.id }}"> Delete
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>

                <label for="new-images">Add New Images:</label>
                <input type="file" id="new-images" name="images" accept="image/*" multiple>

                <div class="image-previews" id="new-image-previews"></div>

                <button type="submit" class="submit-btn">Save</button>
            </form><br><br><br><br><br>
        </div><br><br>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // File upload preview and delete functionality for new images
            const newFileInput = document.getElementById('new-images');
            const newImagePreviewsContainer = document.getElementById('new-image-previews');

            newFileInput.addEventListener('change', function() {
                newImagePreviewsContainer.innerHTML = ''; // Clear previous previews
                Array.from(newFileInput.files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const previewContainer = document.createElement('div');
                        previewContainer.className = 'image-preview';
                        
                        const previewImage = document.createElement('img');
                        previewImage.src = e.target.result;
                        previewContainer.appendChild(previewImage);

                        const deleteButton = document.createElement('button');
                        deleteButton.className = 'delete-btn';
                        deleteButton.textContent = 'Delete';
                        deleteButton.addEventListener('click', function() {
                            previewContainer.remove();
                            const dataTransfer = new DataTransfer();
                            Array.from(newFileInput.files)
                                .filter(f => f !== file)
                                .forEach(f => dataTransfer.items.add(f));
                            newFileInput.files = dataTransfer.files;
                        });
                        previewContainer.appendChild(deleteButton);

                        newImagePreviewsContainer.appendChild(previewContainer);
                    }
                    reader.readAsDataURL(file);
                });
            });

            // Handle deletion of current images
            const currentImagesContainer = document.getElementById('current-images');
            currentImagesContainer.addEventListener('click', function(event) {
                if (event.target.type === 'checkbox' && event.target.name === 'delete_images') {
                    event.target.closest('li').classList.toggle('to-delete');
                }
            });
        });
    </script>
    {% csrf_token %}
    <script>
        function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition, showError);
        } else {
            console.log("Geolocation is not supported by this browser.");
        }
    }
    
    function showPosition(position) {
        var latitude = position.coords.latitude;
        var longitude = position.coords.longitude;
        sendLocationToServer(latitude, longitude);
    }
    
    function showError(error) {
        switch(error.code) {
            case error.PERMISSION_DENIED:
                console.log("User denied the request for Geolocation.");
                break;
            case error.POSITION_UNAVAILABLE:
                console.log("Location information is unavailable.");
                break;
            case error.TIMEOUT:
                console.log("The request to get user location timed out.");
                break;
            case error.UNKNOWN_ERROR:
                console.log("An unknown error occurred.");
                break;
        }
    }
    
    function sendLocationToServer(latitude, longitude) {
        fetch('/save_location/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({ latitude: latitude, longitude: longitude })
        })
        .then(response => response.json())
        .then(data => {
            console.log('Success:', data);
        })
        .catch((error) => {
            console.error('Error:', error);
        });
    }
    
    window.onload = getLocation;
    
    </script>
</body>
</html>
{% endblock %}
